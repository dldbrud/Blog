<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ê¸€ì“°ê¸° - dldbrud Blog</title>
  <link rel="stylesheet" href="style.css" />
  <script>
    // ê³ ìœ  userId ìƒì„± ë° ì €ì¥
    function getUserId() {
      let userId = localStorage.getItem('userId');
      if (!userId) {
        userId = 'user-' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('userId', userId);
      }
      return userId;
    }
    const myUserId = getUserId();
    function setEditorContent({title = '', content = '', fontSize = '16', align = 'left', image = ''} = {}) {
      document.getElementById("post-title").value = title;
      const editor = document.getElementById("post-content-editor");
      editor.innerHTML = content;
      editor.style.fontSize = fontSize + 'px';
      editor.style.textAlign = align;
      document.getElementById("font-size").value = fontSize;
      document.getElementById("align-left").classList.toggle('active', align === 'left');
      document.getElementById("align-center").classList.toggle('active', align === 'center');
      document.getElementById("align-right").classList.toggle('active', align === 'right');
      if (image) {
        document.getElementById("image-preview").src = image;
        document.getElementById("image-preview").style.display = '';
      } else {
        document.getElementById("image-preview").src = '';
        document.getElementById("image-preview").style.display = 'none';
      }
    }
    function handlePostSubmit(event) {
      event.preventDefault();
      const title = document.getElementById("post-title").value;
      const editor = document.getElementById("post-content-editor");
      const content = editor.innerHTML;
      const fontSize = document.getElementById("font-size").value;
      const align = currentAlign;
      const image = document.getElementById("image-preview").src || '';
      if (!title || !content.replace(/<[^>]*>/g, '').trim()) {
        alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”!");
        return;
      }
      const posts = JSON.parse(localStorage.getItem("posts") || "[]");
      const postData = { title, content, fontSize, align, image, private: false, owner: myUserId };
      if (editIndex !== null) {
        posts[editIndex] = { ...posts[editIndex], ...postData };
        editIndex = null;
        document.getElementById("submit-btn").textContent = "ì‘ì„±í•˜ê¸°";
      } else {
        posts.unshift(postData);
      }
      localStorage.setItem("posts", JSON.stringify(posts));
      document.getElementById("post-form").reset();
      setEditorContent();
      alert('ê¸€ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      window.location.href = 'index.html';
    }
    function handleFontSizeChange() {
      const size = document.getElementById("font-size").value;
      document.getElementById("post-content-editor").style.fontSize = size + 'px';
    }
    function handleAlignClick(align) {
      document.getElementById("post-content-editor").style.textAlign = align;
      currentAlign = align;
      // Highlight the selected button
      document.querySelectorAll('.align-btn').forEach(btn => btn.classList.remove('active'));
      document.getElementById('align-' + align).classList.add('active');
    }
    function handleImageUpload(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(ev) {
        document.getElementById("image-preview").src = ev.target.result;
        document.getElementById("image-preview").style.display = '';
      };
      reader.readAsDataURL(file);
    }
    function getQueryParam(name) {
      const url = new URL(window.location.href);
      return url.searchParams.get(name);
    }
    let editIndex = null;
    let currentAlign = 'left';
    function updateAlignLabel(align) {
      const label = document.getElementById('align-label');
      if (!label) return;
      if (align === 'left') label.textContent = 'Align: Left';
      else if (align === 'center') label.textContent = 'Align: Center';
      else if (align === 'right') label.textContent = 'Align: Right';
    }
    function updateAlignIcon(align) {
      // No icon update needed, keep the â‰¡ symbol
    }
    // --- ìë™ ì €ì¥ ë°©ì§€: contenteditable ì˜ì—­ì—ì„œ ì €ì¥ ê¸ˆì§€ ---
    document.addEventListener('DOMContentLoaded', function() {
      // ê¸€ì í¬ê¸° ì˜µì…˜ ë™ì  ìƒì„± (5~50pt)
      const fontSizeSelect = document.getElementById('font-size');
      if (fontSizeSelect && fontSizeSelect.children.length <= 1) {
        for(let i=5;i<=50;i++){
          const opt = document.createElement('option');
          opt.value = i;
          opt.textContent = i + 'pt';
          fontSizeSelect.appendChild(opt);
        }
      }
      // ê¸€ì í¬ê¸° ë³€ê²½: ì„ íƒí•œ í…ìŠ¤íŠ¸ì—ë§Œ ì ìš© (ìë™ ì €ì¥ ì•ˆí•¨)
      if (fontSizeSelect) {
        fontSizeSelect.onchange = function() {
          const size = fontSizeSelect.value;
          const sel = window.getSelection();
          if (!sel.rangeCount) return;
          const range = sel.getRangeAt(0);
          if (range.collapsed) return;
          const span = document.createElement('span');
          span.style.fontSize = size + 'pt';
          range.surroundContents(span);
          // ì €ì¥ ê¸ˆì§€: ìŠ¤íƒ€ì¼ë§Œ ì ìš©
        };
      }
      // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ë²„íŠ¼ ì´ë²¤íŠ¸ (ìë™ ì €ì¥ ì•ˆí•¨)
      document.querySelectorAll('.color-btn').forEach(btn => {
        btn.onclick = function() {
          const color = btn.dataset.color;
          if (color) {
            applyColorToSelection(color);
            // ì €ì¥ ê¸ˆì§€: ìƒ‰ìƒë§Œ ì ìš©
          }
        };
      });
      // ì¶”ê°€í•˜ê¸° ë²„íŠ¼ ì´ë²¤íŠ¸ (ìë™ ì €ì¥ ì•ˆí•¨)
      const addColorBtn = document.getElementById('add-color-btn');
      const colorInput = document.getElementById('inline-font-color');
      if (addColorBtn && colorInput) {
        addColorBtn.onclick = function() {
          colorInput.value = '#000000';
          colorInput.click();
        };
        colorInput.oninput = function(e) {
          applyColorToSelection(e.target.value);
          // ì €ì¥ ê¸ˆì§€: ìƒ‰ìƒë§Œ ì ìš©
        };
      }
      // Bold ì ìš© ì¦‰ì‹œ (ìë™ ì €ì¥ ì•ˆí•¨)
      const boldBtn = document.getElementById('bold-btn');
      if (boldBtn) {
        boldBtn.onclick = function() {
          const sel = window.getSelection();
          if (!sel.rangeCount) return;
          const range = sel.getRangeAt(0);
          if (range.collapsed) return;
          const span = document.createElement('span');
          span.style.fontWeight = 'bold';
          range.surroundContents(span);
          // ì €ì¥ ê¸ˆì§€: êµµê¸°ë§Œ ì ìš©
        };
      }
      // Underline ì ìš© ì¦‰ì‹œ (ìë™ ì €ì¥ ì•ˆí•¨)
      const underlineBtn = document.getElementById('underline-btn');
      if (underlineBtn) {
        underlineBtn.onclick = function() {
          const sel = window.getSelection();
          if (!sel.rangeCount) return;
          const range = sel.getRangeAt(0);
          if (range.collapsed) return;
          const span = document.createElement('span');
          span.style.textDecoration = 'underline';
          range.surroundContents(span);
          // ì €ì¥ ê¸ˆì§€: ë°‘ì¤„ë§Œ ì ìš©
        };
      }
      // contenteditableì—ì„œ ìë™ ì €ì¥ ë°©ì§€
      const editor = document.getElementById('post-content-editor');
      if (editor) {
        // í˜¹ì‹œë¼ë„ input/change/blur/key* ì´ë²¤íŠ¸ì—ì„œ ì €ì¥ì´ ì¼ì–´ë‚˜ì§€ ì•Šë„ë¡ ëª…ì‹œì ìœ¼ë¡œ ë°©ì§€
        editor.addEventListener('input', function(e) {
          // ì €ì¥ ê¸ˆì§€: ì˜¤ì§ handlePostSubmitì—ì„œë§Œ ì €ì¥
        });
        editor.addEventListener('change', function(e) {
          // ì €ì¥ ê¸ˆì§€
        });
        editor.addEventListener('blur', function(e) {
          // ì €ì¥ ê¸ˆì§€
        });
        editor.addEventListener('keyup', function(e) {
          // ì €ì¥ ê¸ˆì§€
        });
      }
    });
    // --- ì €ì¥ì€ ì˜¤ì§ handlePostSubmitì—ì„œë§Œ! ---
    window.onload = function() {
      // edit íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ í•´ë‹¹ ê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
      const editIdx = getQueryParam('edit');
      if (editIdx !== null) {
        const posts = JSON.parse(localStorage.getItem('posts') || '[]');
        const post = posts[editIdx];
        if (post) setEditorContent(post);
        editIndex = Number(editIdx);
        document.getElementById("submit-btn").textContent = "ìˆ˜ì • ì €ì¥";
        if (post && post.align) currentAlign = post.align;
      } else {
        setEditorContent();
        editIndex = null;
        document.getElementById("submit-btn").textContent = "ì‘ì„±í•˜ê¸°";
        currentAlign = 'left';
      }
      // ê¸€ ì‘ì„± í¼ ê¶Œí•œ ì²˜ë¦¬
      const formCard = document.querySelector('.card');
      if (formCard) {
        formCard.querySelector('#post-form').style.display = '';
        const info = formCard.querySelector('.no-write');
        if (info) info.remove();
      }
    }
    function applyColorToSelection(color) {
      const sel = window.getSelection();
      if (!sel.rangeCount) return;
      const range = sel.getRangeAt(0);
      if (range.collapsed) return;
      const span = document.createElement('span');
      span.style.color = color;
      range.surroundContents(span);
      // ìë™ ì €ì¥ ì œê±° - ìƒ‰ìƒë§Œ ì ìš©
    }
  </script>
</head>
<body>
  <header>
    <h1>dldbrud Blog</h1>
    <nav>
      <a href="index.html">Home</a> |
      <a href="about.html">About</a>
    </nav>
  </header>
  <main>
    <div class="card">
      <h2>ğŸ“ Write New Post</h2>
      <form id="post-form" onsubmit="handlePostSubmit(event)">
        <input type="text" id="post-title" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required style="font-size:1.3em; font-weight:bold; margin-bottom:18px; margin-top:2px; padding:14px 12px; border-radius:10px; border:1.5px solid #b0cbe8; background:#f7fafd;" />
        <div id="editor-toolbar" style="margin-bottom:8px; display:flex; align-items:center; gap:6px; flex-wrap:wrap; position:relative;">
          <!-- ìƒ‰ìƒ íŒ”ë ˆíŠ¸ (í•œì»´ì˜¤í”¼ìŠ¤ ìŠ¤íƒ€ì¼) -->
          <div id="color-palette" style="display:flex; flex-direction:row; gap:2px; align-items:center;">
            <div style="display:flex; gap:2px; align-items:center;">
              <button class="color-btn" style="background:#000; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#000" title="ê²€ì •"></button>
              <button class="color-btn" style="background:#e74c3c; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#e74c3c" title="ë¹¨ê°•"></button>
              <button class="color-btn" style="background:#2980b9; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#2980b9" title="íŒŒë‘"></button>
              <button class="color-btn" style="background:#27ae60; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#27ae60" title="ì´ˆë¡"></button>
              <button class="color-btn" style="background:#f1c40f; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#f1c40f" title="ë…¸ë‘"></button>
              <button class="color-btn" style="background:#8e44ad; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#8e44ad" title="ë³´ë¼"></button>
              <button class="color-btn" style="background:#7f8c8d; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#7f8c8d" title="íšŒìƒ‰"></button>
              <button class="color-btn" style="background:#fff; width:10px; height:10px; border-radius:2px; border:1px solid #bbb;" data-color="#fff" title="í°ìƒ‰"></button>
              <button id="add-color-btn" style="width:38px; height:16px; border-radius:4px; border:1px dashed #bbb; background:#f7fafd; color:#444; font-size:0.95em; margin-left:6px; display:flex; align-items:center; justify-content:center; padding:0 4px;" title="ìƒ‰ìƒ ì¶”ê°€">+ ì¶”ê°€í•˜ê¸°</button>
              <input type="color" id="inline-font-color" style="display:none;" />
            </div>
          </div>
          <!-- ê¸€ì í¬ê¸° ë“œë¡­ë‹¤ìš´ (5~50pt) -->
          <select id="font-size" class="toolbar-btn" title="Font Size" style="width:54px; height:28px; border-radius:5px; font-size:0.95em;">
            <option value="">pt</option>
            <!-- JSë¡œ 5~50ê¹Œì§€ ì˜µì…˜ ì¶”ê°€ -->
          </select>
          <!-- Bold/Underline -->
          <button type="button" id="bold-btn" class="toolbar-btn" title="Bold (B)" style="font-weight:bold; font-size:1.1em; width:28px; height:28px; border-radius:5px; display:inline-flex; align-items:center; justify-content:center;">B</button>
          <button type="button" id="underline-btn" class="toolbar-btn" title="Underline (U)" style="text-decoration:underline; font-size:1.1em; width:28px; height:28px; border-radius:5px; display:inline-flex; align-items:center; justify-content:center;">U</button>
          <!-- ì •ë ¬ ë²„íŠ¼ 3ê°œ (ì‚¬ì§„ì²˜ëŸ¼ ì™„ë²½í•˜ê²Œ) -->
          <button type="button" class="toolbar-btn align-btn" id="align-left" data-align="left" onclick="handleAlignClick('left');" title="ì™¼ìª½ ì •ë ¬" style="width:36px; height:36px; border-radius:8px; background:#dbeafe; border:1.5px solid #b0cbe8; display:flex; flex-direction:column; justify-content:center; align-items:flex-start; padding:4px;">
            <span style="display:block; width:18px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:13px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:8px; height:3px; background:#444; border-radius:2px;"></span>
          </button>
          <button type="button" class="toolbar-btn align-btn" id="align-center" data-align="center" onclick="handleAlignClick('center');" title="ê°€ìš´ë° ì •ë ¬" style="width:36px; height:36px; border-radius:8px; background:#dbeafe; border:1.5px solid #b0cbe8; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:4px;">
            <span style="display:block; width:18px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:13px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:8px; height:3px; background:#444; border-radius:2px;"></span>
          </button>
          <button type="button" class="toolbar-btn align-btn" id="align-right" data-align="right" onclick="handleAlignClick('right');" title="ì˜¤ë¥¸ìª½ ì •ë ¬" style="width:36px; height:36px; border-radius:8px; background:#dbeafe; border:1.5px solid #b0cbe8; display:flex; flex-direction:column; justify-content:center; align-items:flex-end; padding:4px;">
            <span style="display:block; width:18px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:13px; height:3px; background:#444; border-radius:2px; margin-bottom:3px;"></span>
            <span style="display:block; width:8px; height:3px; background:#444; border-radius:2px;"></span>
          </button>
          <!-- ì´ë¯¸ì§€ ì—…ë¡œë“œ -->
          <input type="file" id="image-upload" accept="image/*" style="display:none" onchange="handleImageUpload(event)" />
          <button type="button" class="img-btn" onclick="document.getElementById('image-upload').click()" title="Attach Image" style="width:28px;height:28px;padding:0; border-radius:5px; font-size:1.2em;">ğŸ“·</button>
        </div>
        <img id="image-preview" src="" style="max-width:80px; display:none; margin-bottom:6px; border-radius:6px; border:1px solid #eee;" />
        <div id="post-content-editor" contenteditable="true" style="border:1px solid #ccc; min-height:80px; padding:8px; margin-bottom:8px; font-size:16px; text-align:left; border-radius:6px;"></div>
        <button type="submit" id="submit-btn" style="padding:6px 16px; font-size:1em; border-radius:6px;">ì‘ì„±í•˜ê¸°</button>
      </form>
      <p style="font-size: 0.9em; color: #777;">* ì‘ì„±í•œ ê¸€ì€ ë¸Œë¼ìš°ì €ì— ì„ì‹œ ì €ì¥ë©ë‹ˆë‹¤. (LocalStorage ì‚¬ìš©)</p>
    </div>
  </main>
  <footer>
    <p>&copy; 2025 YuKyeong's Blog</p>
  </footer>
</body>
</html> 